<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
				xmlns:s="library://ns.adobe.com/flex/spark"
				creationComplete="init(event)" 
				contentBackgroundAlpha="1"
				 autoDrawBackground="false"		
				 dataChange="datachango()"
				mouseOver="gOver();"
				mouseOut="gOut();" 
				mouseUp="gOut();" 
				mouseDown="gDown();" >
	<fx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			import spark.components.Group;
			import spark.components.Label;
			import spark.components.VGroup;
			import spark.core.ContentCache;
			import spark.primitives.BitmapImage;
			static public const s_imageCache:ContentCache = new ContentCache();
			public var v1:Group = new Group();
			public var addedallitems:Boolean = false;
			public var gapo:uint = 2;
			protected function init(event:FlexEvent):void
			{
				var neededwidth:Number = this.parent.width/2-gapo;
				v1.width = neededwidth;
				v1.height = neededwidth;
				v1.mouseEnabled = false;
				this.addElement(v1);
				if ((data.viz == true)&&(addedallitems == false)){
					loadrest();
				}
			}
			protected function datachango():void
			{
				if (data != null){
					var neededwidth:Number = this.parent.width/2-gapo;
					if ((data.viz == true)&&(addedallitems == false)){
						loadrest();
					}
					else {
						v1.removeAllElements();
						addedallitems = false;
						if (data.viz){
							loadrest();
						}
						
					}
				}
			}
			
			public function loadrest():void {
				var neededwidth:Number = this.parent.width/2-gapo;
				if (addedallitems == false){
					trace(data.business_name+" is now visible");
					addedallitems = true;
					var bmpImg:BitmapImage = new BitmapImage();
					bmpImg.source = data.business_picture2;
					bmpImg.contentLoader = s_imageCache;
					bmpImg.width = neededwidth;
					bmpImg.height = neededwidth;
					bmpImg.bottom = 0;
					bmpImg.scaleMode = "zoom";
					
					var bmpImg2:BitmapImage = new BitmapImage();
					bmpImg2.source = '../assets/'+getDPIHeight().toString()+'/gradient.png';
					bmpImg2.contentLoader = s_imageCache;
					bmpImg2.width = neededwidth;
					bmpImg2.height = neededwidth;
					bmpImg2.bottom = 0;
					bmpImg2.scaleMode = "stretch";
					v1.addElement(bmpImg);
					v1.addElement(bmpImg2);
					
					
					var v2:VGroup = new VGroup();
					v2.width = neededwidth;
					v2.verticalAlign = "bottom";
					v2.percentHeight = 100;
					v2.horizontalAlign = "left"
					v2.paddingBottom = 10/(320/Capabilities.screenDPI);
					v2.bottom = 0;
					
					
					var l4:Label = new Label();
					l4.width = neededwidth-(10/(320/Capabilities.screenDPI));
					l4.setStyle("paddingLeft",10/(320/Capabilities.screenDPI));
					l4.setStyle("paddingRight",10/(320/Capabilities.screenDPI));
					l4.setStyle("fontWeight","bold");
					l4.styleName =  "textsize2";
					l4.setStyle("color","#FFFFFF");
					l4.text = data.business_name;
					l4.maxDisplayedLines = 1;
					l4.maxWidth = neededwidth;
					
					var l5:Label = new Label();
					l5.width = neededwidth-(10/(320/Capabilities.screenDPI));
					l5.setStyle("paddingLeft",10/(320/Capabilities.screenDPI));
					l5.setStyle("paddingRight",10/(320/Capabilities.screenDPI));
					l5.styleName =  "textsize2";
					l5.setStyle("color","#DDDDDD");
					l5.maxDisplayedLines = 1;
					if ((data.distance != '')&&(data.distance != 'null')&&(data.distance != null)){
						var dist:Number = data.distance;
						if (dist >= 1){
							l5.text = dist.toFixed(1)+ " km";
						}
						else {
							dist = dist * 1000;
							l5.text = dist.toFixed(0)+ " m";
						}
					}
					else {
						l5.text = "";
					}
					
					v2.addElement(l4);
					v2.addElement(l5);
					v1.addElement(v2);			
				}	
				
			}
			public function getDPIHeight():Number {
				var _runtimeDPI:int;
				if(Capabilities.screenDPI < 200){
					_runtimeDPI = 160;
				}
				else if(Capabilities.screenDPI >=200 && Capabilities.screenDPI <= 240){
					_runtimeDPI = 240
				}
				else if (Capabilities.screenDPI < 480){
					_runtimeDPI = 320;
				}
				else if (Capabilities.screenDPI < 640){
					_runtimeDPI = 480;
				}
				else if (Capabilities.screenDPI >=640){
					_runtimeDPI = 640;
				}
				return(_runtimeDPI)
			}
			public function gOver():void {
				this.alpha = 0.5;
			}
			public function gDown():void {
				this.alpha = 0.5;
			}
			public function gOut():void {
				this.alpha = 1;
			}
		]]>
	</fx:Script>
</s:ItemRenderer>