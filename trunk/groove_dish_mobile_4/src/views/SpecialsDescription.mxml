<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:mx="library://ns.adobe.com/flex/mx" 
		xmlns:s="library://ns.adobe.com/flex/spark" 
		xmlns:components="components.*"
		backgroundColor="#FFFFFF"
		contentBackgroundColor="#f3f3f3"
		viewActivate="init()"  
		actionBarVisible="false">
	<fx:Script source="../func/global.as"/>
	<fx:Script>
		<![CDATA[
			import flash.events.MouseEvent;
			import flash.filesystem.File;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			
			import spark.events.ViewNavigatorEvent;
			
			import components.ratingsResultStore;
			[Bindable]
			public var finaldate:String = "";
			[Bindable]
			public var likemode:Number = -1;
			public function init():void
			{
				
				if (data.liked == 'yes'){
					likemode = 1;
				}
				else {
					likemode = 0;
				}
				updatelikelabel();
				if (data.yearly == 'y'){
					var date1:String = data.startdate;
					date1 = date1.substring(5,date1.length);
					var month1:String = getMonth(Number(date1.substring(0,2)));
					date1 = date1.substring(3,date1.length);
					
					var date2:String = data.enddate;
					date2 = date2.substring(5,date2.length);
					var month2:String = getMonth(Number(date2.substring(0,2)));
					date2 = date2.substring(3,date2.length);
					
					
					if (date1.charAt(0) == "0"){
						date1 = date1.substr(1,date1.length);
					}
					
					if (date2.charAt(0) == "0"){
						date2 = date2.substr(1,date2.length);
					}
					
					finaldate = month1+" "+ date1 + " - " + month2+" "+ date2;
					
				}
				else {
					var tempweekstring:String = data.weekday;
					finaldate = tempweekstring.substring(0,1).toUpperCase()+
						tempweekstring.substring(1,tempweekstring.length)+"s";
				}

				setLoginVars();	
				//getSpecialDescription.send();
				if (Capabilities.version.indexOf('IOS') > -1){
					if (getDPIHeight() == 320){
						backbutton.top = 20;
					}
					else if (getDPIHeight() == 160){
						backbutton.top = 10;
					}
				}
				
				backbutton.visible = true;
				if ((data.picture == "None")||(data.picture == "")||(data.picture == null)||(data.picture == "null")){
					img1.source = "assets/"+getDPIHeight().toString()+"/dish_place_wide.png";	
				}

				img1.visible = true;

				sharePopup.itemid = data.id;
				sharePopup.email = emailGo;
				sharePopup.locationid = data.locationid;
				sharePopup.menuname = data.name;
				sharePopup.businessname = data.business_name;
				sharePopup.mypic = pictureGo;
				
			}

			public function goback(ev:MouseEvent):void {
				navigator.popView();
			}
			public function backOver(ev:MouseEvent):void {
				ev.currentTarget.setStyle("backgroundColor",0xecf9f7);
			}
			public function backDown(ev:MouseEvent):void {
				ev.currentTarget.setStyle("backgroundColor",0xecf9f7);
			}
			public function backOut(ev:MouseEvent):void {
				ev.currentTarget.setStyle("backgroundColor",0xFFFFFF);
			}
			public function startShare():void {
				sharePopup.startShare();
			}

			public function gotobusiness():void {
				try{
					var dataArray:ArrayCollection = getDatabaseArray("SELECT * FROM merchusers");
					if (dataArray.length != 0){
						for (var i:uint = 0; i < dataArray.length; i++){
							if (dataArray[i].id == data.locationid){
								navigator.pushView(StoresDescription, dataArray[i]);	
							}
						}
					}
				}
				catch(e:Error){}
			}
			public function likeThis():void {
				if (likemode == 0){
					likemode = 1;
				}
				else {
					likemode = 0;
				}
				updateLikeStatus.send();
				updatelikelabel();
			}
			public function updatelikelabel():void {
				if (likemode == 0){
					likelabel.text = "Like";
					likeback.color = 0x36ccba;
					likeback.alpha = 1;
				}
				else {
					likelabel.text = "Unlike";
					likeback.color = 0xc4c4c4;
					likeback.alpha = 1;
				}
			}
			public function getMonth(u:Number):String{
				switch (u){
					case 1 :
						return "Jan";
						break;
					case 2 :
						return "Feb";
						break;
					case 3 :
						return "Mar";
						break;
					case 4 :
						return "Apr";
						break;
					case 5 :
						return "May";
						break;
					case 6 :
						return "Jun";
						break;
					case 7 :
						return "Jul";
						break;
					case 8 :
						return "Aug";
						break;
					case 9 :
						return "Sep";
						break;
					case 10 :
						return "Oct";
						break;
					case 11 :
						return "Nov";
						break;
					case 12 :
						return "Dec";
						break;
				}
				return "";
			}
		]]>
	</fx:Script>
	<fx:Declarations>		
		<s:HTTPService id="updateLikeStatus" method="GET" resultFormat="array"
					   url="http://www.groovedish.com/php/mobile/updateSpecialLikes.php">
			<s:request xmlns="">
				<email>{emailGo}</email>	
				<specialid>{data.id}</specialid>	
				<liketype>{likemode}</liketype>	
				<merchid>{data.merchid}</merchid>	
				<locationid>{data.locationid}</locationid>	
			</s:request>
		</s:HTTPService>
		<s:MultiDPIBitmapSource id="topratedrecent1"
								source160dpi="@Embed('../assets/160/topratedrecent1.png')"
								source240dpi="@Embed('../assets/240/topratedrecent1.png')"
								source320dpi="@Embed('../assets/320/topratedrecent1.png')"
								source480dpi="@Embed('../assets/480/topratedrecent1.png')"
								source640dpi="@Embed('../assets/640/topratedrecent1.png')"/>
		<s:MultiDPIBitmapSource id="topratedrecent2"
								source160dpi="@Embed('../assets/160/topratedrecent2.png')"
								source240dpi="@Embed('../assets/240/topratedrecent2.png')"
								source320dpi="@Embed('../assets/320/topratedrecent2.png')"
								source480dpi="@Embed('../assets/480/topratedrecent2.png')"
								source640dpi="@Embed('../assets/640/topratedrecent2.png')"/>
	</fx:Declarations>
	<s:Scroller id="scroller" visible="true" left="0" right="0" height="100%" 
				width="{this.width}"  maxWidth="{this.width}"
				horizontalScrollPolicy="off" verticalCenter="0" verticalScrollPolicy="on">
		<s:VGroup height="100%" paddingTop="0" gap="{30/(320/Capabilities.screenDPI)}" 
				  horizontalCenter="0" verticalCenter="0"  width="{this.width}"  maxWidth="{this.width}" >
			<s:Group width="100%" height="{img1.height}"   id="megacont"  >
				<s:BitmapImage id="img1"  width="{this.width}"  maxWidth="{this.width}" scaleMode="zoom"
							   top="0"  height="{this.width/(640/300)}"
							   source="{data.picture}"  contentLoader="{s_imageCache}" />
				<s:BitmapImage id="shaddow"  width="100%" height="{img1.height}"  top="0"
							   scaleMode="stretch"	contentLoader="{s_imageCache}"   >
					<s:source>
						<s:MultiDPIBitmapSource source160dpi="@Embed('../assets/160/pictureshadowflipped.png')"
												source240dpi="@Embed('../assets/240/pictureshadowflipped.png')"
												source320dpi="@Embed('../assets/320/pictureshadowflipped.png')"
												source480dpi="@Embed('../assets/480/pictureshadowflipped.png')"
												source640dpi="@Embed('../assets/640/pictureshadowflipped.png')"/>
					</s:source>
				</s:BitmapImage>
				<s:Group width="{this.width*0.30}" height="{this.width*0.30}"  visible="false"
						 mouseEnabledWhereTransparent="true" id="backbutton"  left="0"  
						 mouseDown="navigator.popView();">
					<s:BitmapImage top="{40/(320/Capabilities.screenDPI)}" 
								   left="{30/(320/Capabilities.screenDPI)}"
								   contentLoader="{s_imageCache}" >
						<s:source>
							<s:MultiDPIBitmapSource source160dpi="@Embed('../assets/160/back.png')"
													source240dpi="@Embed('../assets/240/back.png')"
													source320dpi="@Embed('../assets/320/back.png')"
													source480dpi="@Embed('../assets/480/back.png')"
													source640dpi="@Embed('../assets/640/back.png')"/>
						</s:source>
					</s:BitmapImage>
				</s:Group>
				<s:Group bottom="{20/(320/Capabilities.screenDPI)}" left="{30/(320/Capabilities.screenDPI)}">
					<s:Rect width="100%"  height="100%" radiusX="5" radiusY="5">
						<s:fill>
							<s:SolidColor alpha="0.7" color="#36ccba"/>
						</s:fill>
					</s:Rect>
					<s:Label  color="#FFFFFF" 
							  paddingBottom="10" paddingLeft="15"
							  paddingRight="15" paddingTop="10" 
							  text="{data.value}"  fontWeight="bold"
							  horizontalCenter="0" verticalCenter="3"
							  styleName="textsize5" 
							  maxDisplayedLines="1"
							  verticalAlign="middle"></s:Label>
				</s:Group>
			</s:Group>
			
			<s:VGroup width="{this.width}"  maxWidth="{this.width}" 
					  gap="{25/(320/Capabilities.screenDPI)}" paddingLeft="0" paddingRight="0">
				<s:HGroup gap="{15/(320/Capabilities.screenDPI)}" paddingLeft="{30/(320/Capabilities.screenDPI)}" verticalAlign="top">
					<s:BitmapImage  id="starimg"	contentLoader="{s_imageCache}" >
						<s:source>
							<s:MultiDPIBitmapSource source160dpi="@Embed('../assets/160/specialsstar.png')"
													source240dpi="@Embed('../assets/240/specialsstar.png')"
													source320dpi="@Embed('../assets/320/specialsstar.png')"
													source480dpi="@Embed('../assets/480/specialsstar.png')"
													source640dpi="@Embed('../assets/640/specialsstar.png')"/>
						</s:source>
					</s:BitmapImage>
					<s:VGroup width="{this.width}"  maxWidth="{this.width}" 
							  gap="{10/(320/Capabilities.screenDPI)}" paddingLeft="0" paddingRight="0">
						<s:Label id="selectedTitle"  maxDisplayedLines="1" 
								paddingTop="{2/(320/Capabilities.screenDPI)}"
								 width="100%" color="#4d4d4d"  verticalCenter="0" maxWidth="{this.width*0.70}"
								 styleName="textsize4" fontWeight="bold" text="{data.name}"/>
						<s:Label  color="#36ccba" fontWeight="bold" click="gotobusiness();"
								
								  mouseDown="gDown(event)" mouseOver="gOver(event)" 
								  mouseUp="gOut(event)" mouseOut="gOut(event)"
								  styleName="textsize3" text="{data.business_name+ ' • ' + finaldate }"
								  verticalAlign="middle"/>
					</s:VGroup>
				</s:HGroup>
				
				<s:Label width="100%"  
						 paddingLeft="{30/(320/Capabilities.screenDPI)}" 
						 paddingRight="{30/(320/Capabilities.screenDPI)}"
						 color="#4d4d4d" fontWeight="normal" id="descriptiontext"  lineHeight="{35/(320/Capabilities.screenDPI)}" styleName="textsize0"
						 text="{data.description}" textDecoration="none"
						 verticalAlign="middle"/>
				
				
				<s:Group width="100%">
					<s:Line left="{30/(320/Capabilities.screenDPI)}" right="0"  bottom="0" > 
						<s:stroke><s:SolidColorStroke color="0xb2b2b2" weight="{1/(320/Capabilities.screenDPI)}"/></s:stroke>
					</s:Line>
				</s:Group>
				
				
				<s:Group  width="100%" >
					<s:Group width="100%"  horizontalCenter="0"  verticalCenter="0">
						<s:Group click="likeThis();" height="{60/(320/Capabilities.screenDPI)}" 
								 mouseDown="gDown(event)" mouseOver="gOver(event)"
								 mouseUp="gOut(event)" mouseOut="gOut(event)"
								 width="{this.width/2-(40/(320/Capabilities.screenDPI))}" left="{30/(320/Capabilities.screenDPI)}">
							<s:Rect width="100%"  height="100%"
									radiusX="{10/(320/Capabilities.screenDPI)}"
									radiusY="{10/(320/Capabilities.screenDPI)}">
								<s:fill>
									<s:SolidColor id="likeback" alpha="0" color="#36ccba"/>
								</s:fill>
							</s:Rect>
							<s:Label  id="likelabel" verticalAlign="middle" mouseEnabled="false" horizontalCenter="0"  verticalCenter="2" 
									 text="Like" color="#FFFFFF"  textAlign="center" styleName="textsize2"  fontWeight="bold"/>
						</s:Group>
						<s:Group click="startShare();" height="{60/(320/Capabilities.screenDPI)}" 
								 width="{this.width/2-(40/(320/Capabilities.screenDPI))}" right="{30/(320/Capabilities.screenDPI)}"
								 mouseDown="gDown(event)" mouseOver="gOver(event)"
								 mouseUp="gOut(event)" mouseOut="gOut(event)">
							<s:Rect width="100%"  height="100%"
									radiusX="{10/(320/Capabilities.screenDPI)}"
									radiusY="{10/(320/Capabilities.screenDPI)}">
								<s:fill>
									<s:SolidColor alpha="1" color="#6594db"/>
								</s:fill>
							</s:Rect>
							<s:Label verticalAlign="middle" textAlign="center"  mouseEnabled="false"  
									 text="Share" color="#FFFFFF" styleName="textsize2"  
									 fontWeight="bold" horizontalCenter="0"  verticalCenter="2" />
						</s:Group>
					</s:Group>				
				</s:Group>
				<s:Group height="{10/(320/Capabilities.screenDPI)}">
					
				</s:Group>
				
			</s:VGroup>
		</s:VGroup>
	</s:Scroller>
	<components:sharePopup id="sharePopup"  width="100%" height="100%" visible="false"/>
</s:View>