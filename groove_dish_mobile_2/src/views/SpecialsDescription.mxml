<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:mx="library://ns.adobe.com/flex/mx" 
		xmlns:s="library://ns.adobe.com/flex/spark" 
		xmlns:components="components.*"
		backgroundColor="#FFFFFF"
		contentBackgroundColor="#f3f3f3"
		viewActivate="init()"  
		actionBarVisible="false">
	<fx:Script source="../func/global.as"/>
	<fx:Script>
		<![CDATA[
			import flash.events.MouseEvent;
			import flash.filesystem.File;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			
			import spark.events.ViewNavigatorEvent;
			
			import components.ratingsResultStore;
			public function init():void
			{
				didlistclick = false;
				setLoginVars();	
				//getSpecialDescription.send();
				if (Capabilities.version.indexOf('IOS') > -1){
					if (getDPIHeight() == 320){
						backbutton.top = 20;
					}
					else if (getDPIHeight() == 160){
						backbutton.top = 10;
					}
				}
				
				backbutton.visible = true;
				if ((data.picture == "None")||(data.picture == "")||(data.picture == null)||(data.picture == "null")){
					img1.source = "assets/"+getDPIHeight().toString()+"/dish_place_wide.png";	
					reviewPopupGroup.itemimg = "assets/"+getDPIHeight().toString()+"/dish_place_square.png";	
				}
				else {
					reviewPopupGroup.itemimg = data.picture;
				}
				img1.visible = true;
				
				
				
				reviewPopupGroup.itemid = data.id;
				reviewPopupGroup.type = "special";
				reviewPopupGroup.email = emailGo;
				reviewPopupGroup.locationid = data.locationid;
				reviewPopupGroup.itemname = data.name;
				reviewPopupGroup.businessname = data.business_name;
				reviewPopupGroup.mypic = pictureGo;
				
				
				sharePopup.itemid = data.id;
				sharePopup.email = emailGo;
				sharePopup.locationid = data.locationid;
				sharePopup.menuname = data.name;
				sharePopup.businessname = data.business_name;
				sharePopup.mypic = pictureGo;
				getSpecialInformation.send();
				
			}
			public function afterGetDesc(ev:ResultEvent):void {
				var stop:String = "";
				
				reviewPopupGroup.reviewText.text = "";
				topreviews = new ArrayCollection();
				recentreviews = new ArrayCollection();
				
				try{			
					topreviews = ev.result[0].results.result;	
				}
				catch(e:Error){
					try{
						
						topreviews.addItem(ev.result[0].results.result);
					}
					catch(e:Error){
					}
				}
				
				try{			
					recentreviews = ev.result[0].results2.result2;	
				}
				catch(e:Error){
					try{
						
						recentreviews.addItem(ev.result[0].results2.result2);
					}
					catch(e:Error){
					}
				}
				reviewList.dataProvider = topreviews;
				reviewlabel.text = 'Reviews ('+topreviews.length.toString()+')';
			}
			public function goback(ev:MouseEvent):void {
				navigator.popView();
			}
			public function backOver(ev:MouseEvent):void {
				ev.currentTarget.setStyle("backgroundColor",0xecf9f7);
			}
			public function backDown(ev:MouseEvent):void {
				ev.currentTarget.setStyle("backgroundColor",0xecf9f7);
			}
			public function backOut(ev:MouseEvent):void {
				ev.currentTarget.setStyle("backgroundColor",0xFFFFFF);
			}
			public function startShare():void {
				sharePopup.startShare();
			}
			public var didlistclick:Boolean = false;
			[Bindable]
			public var topreviews:ArrayCollection = new ArrayCollection();
			[Bindable]
			public var topratedrecentval:uint = 1;
			[Bindable]
			public var recentreviews:ArrayCollection = new ArrayCollection();
			public function topratedrecentclick(event:MouseEvent):void
			{
				if (topratedrecentval == 1){
					topratedrecentval = 2;
					topratedrecentimg.source = topratedrecent2;
					reviewList.dataProvider = recentreviews;
					reviewlabel.text = 'Reviews ('+recentreviews.length.toString()+')';
				}
				else {
					topratedrecentval = 1;
					topratedrecentimg.source = topratedrecent1;
					reviewList.dataProvider = topreviews;
					reviewlabel.text = 'Reviews ('+topreviews.length.toString()+')';
				}
				
				
			}
		
			public function seemoreclick():void {
				navigator.pushView(SpecialsReviews,{id:data.id});
			}
		]]>
	</fx:Script>
	<fx:Declarations>		
		<s:HTTPService id="getSpecialInformation" method="GET" resultFormat="array"
					   url="http://www.groovedish.com/php/mobile/getSpecialsInformation.php"
					   result="afterGetDesc(event)" >
			<s:request xmlns="">
				<specialid>{data.id}</specialid>
				<emailGo>{emailGo}</emailGo>
			</s:request>
		</s:HTTPService>
		<s:MultiDPIBitmapSource id="topratedrecent1"
								source160dpi="@Embed('../assets/160/topratedrecent1.png')"
								source240dpi="@Embed('../assets/240/topratedrecent1.png')"
								source320dpi="@Embed('../assets/320/topratedrecent1.png')"
								source480dpi="@Embed('../assets/480/topratedrecent1.png')"
								source640dpi="@Embed('../assets/640/topratedrecent1.png')"/>
		<s:MultiDPIBitmapSource id="topratedrecent2"
								source160dpi="@Embed('../assets/160/topratedrecent2.png')"
								source240dpi="@Embed('../assets/240/topratedrecent2.png')"
								source320dpi="@Embed('../assets/320/topratedrecent2.png')"
								source480dpi="@Embed('../assets/480/topratedrecent2.png')"
								source640dpi="@Embed('../assets/640/topratedrecent2.png')"/>
	</fx:Declarations>
	<s:Scroller id="scroller" visible="true" left="0" right="0" height="100%" 
				width="{this.width}"  maxWidth="{this.width}"
				horizontalScrollPolicy="off" verticalCenter="0" verticalScrollPolicy="on">
		<s:VGroup height="100%" paddingTop="0" gap="{30/(320/Capabilities.screenDPI)}" 
				  horizontalCenter="0" verticalCenter="0"  width="{this.width}"  maxWidth="{this.width}" >
			<s:Group width="100%" height="{img1.height}"   id="megacont"  >
				<s:BitmapImage id="img1"  width="{this.width}"  maxWidth="{this.width}" scaleMode="zoom"
							   top="0"  height="{this.width/(640/300)}"
							   source="{data.picture}"  contentLoader="{s_imageCache}" />
				<s:BitmapImage id="shaddow"  width="100%" height="{img1.height}"  top="0"
							   scaleMode="stretch"	contentLoader="{s_imageCache}"   >
					<s:source>
						<s:MultiDPIBitmapSource source160dpi="@Embed('../assets/160/pictureshadowfliped.png')"
												source240dpi="@Embed('../assets/240/pictureshadowfliped.png')"
												source320dpi="@Embed('../assets/320/pictureshadowfliped.png')"
												source480dpi="@Embed('../assets/480/pictureshadowfliped.png')"
												source640dpi="@Embed('../assets/640/pictureshadowfliped.png')"/>
					</s:source>
				</s:BitmapImage>
				<s:Group width="{this.width*0.30}" height="{this.width*0.30}"  visible="false"
						 mouseEnabledWhereTransparent="true" id="backbutton"  left="0"  
						 mouseDown="navigator.popView();">
					<s:BitmapImage top="{40/(320/Capabilities.screenDPI)}" 
								   left="{30/(320/Capabilities.screenDPI)}"
								   contentLoader="{s_imageCache}" >
						<s:source>
							<s:MultiDPIBitmapSource source160dpi="@Embed('../assets/160/back.png')"
													source240dpi="@Embed('../assets/240/back.png')"
													source320dpi="@Embed('../assets/320/back.png')"
													source480dpi="@Embed('../assets/480/back.png')"
													source640dpi="@Embed('../assets/640/back.png')"/>
						</s:source>
					</s:BitmapImage>
				</s:Group>
			</s:Group>
			
			<s:VGroup width="{this.width}"  maxWidth="{this.width}" 
					  gap="{25/(320/Capabilities.screenDPI)}" paddingLeft="0" paddingRight="0">
				<s:HGroup paddingLeft="{20/(320/Capabilities.screenDPI)}" verticalAlign="middle">
					<s:Group>
						<s:Rect width="100%"  height="100%" radiusX="5" radiusY="5">
							<s:fill>
								<s:SolidColor alpha="0.7" color="#36ccba"/>
							</s:fill>
						</s:Rect>
						<s:Label  color="#FFFFFF" 
								  paddingBottom="10" paddingLeft="15"
								  paddingRight="15" paddingTop="10" 
								  text="{data.value}"  fontWeight="bold"
								  horizontalCenter="0" verticalCenter="3"
								  styleName="textsize5" 
								  maxDisplayedLines="1"
								  verticalAlign="middle"></s:Label>
					</s:Group>
					<s:Label   paddingLeft="{20/(320/Capabilities.screenDPI)}" 
							   paddingRight="{20/(320/Capabilities.screenDPI)}"
							   width="100%" color="#4d4d4d" paddingTop="5"
							   styleName="textsize4" fontWeight="bold" text="{data.categoryname}"/>
				</s:HGroup>
				<s:Label id="selectedTitle"  paddingLeft="{20/(320/Capabilities.screenDPI)}" 
						 paddingRight="{20/(320/Capabilities.screenDPI)}" paddingTop="{2/(320/Capabilities.screenDPI)}"
						 width="100%" color="#4d4d4d"  verticalCenter="0" maxWidth="{this.width*0.90}"
						 styleName="textsize4" fontWeight="bold" text="{data.name}"/>
				<s:Label width="100%"  
						 paddingLeft="{20/(320/Capabilities.screenDPI)}" 
						 paddingRight="{20/(320/Capabilities.screenDPI)}"
						 color="#4d4d4d" fontWeight="normal" id="descriptiontext"  lineHeight="{35/(320/Capabilities.screenDPI)}" styleName="textsize0"
						 text="{data.description}" textDecoration="none"
						 verticalAlign="middle"/>
				
				
				<s:Group width="100%">
					<s:Line left="{20/(320/Capabilities.screenDPI)}" right="0"  bottom="0" > 
						<s:stroke><s:SolidColorStroke color="0xb2b2b2" weight="{1/(320/Capabilities.screenDPI)}"/></s:stroke>
					</s:Line>
				</s:Group>
				
				
				<s:Group  width="100%" >
					<s:Group width="100%"  horizontalCenter="0"  verticalCenter="0">
						<s:Group click="reviewPopupGroup.startReview();" height="{60/(320/Capabilities.screenDPI)}" 
								 mouseDown="gDown(event)" mouseOver="gOver(event)"
								 mouseUp="gOut(event)" mouseOut="gOut(event)"
								 width="{this.width/2-30}" left="{20/(320/Capabilities.screenDPI)}">
							<s:Rect width="100%"  height="100%"
									radiusX="{10/(320/Capabilities.screenDPI)}"
									radiusY="{10/(320/Capabilities.screenDPI)}">
								<s:fill>
									<s:SolidColor alpha="1" color="#36ccba"/>
								</s:fill>
							</s:Rect>
							<s:Label verticalAlign="middle" mouseEnabled="false" horizontalCenter="0"  verticalCenter="2" 
									 text="Rate" color="#FFFFFF"  textAlign="center" styleName="textsize2"  fontWeight="bold"/>
						</s:Group>
						<s:Group click="startShare();" height="{60/(320/Capabilities.screenDPI)}" 
								 width="{this.width/2-30}" right="{20/(320/Capabilities.screenDPI)}"
								 mouseDown="gDown(event)" mouseOver="gOver(event)"
								 mouseUp="gOut(event)" mouseOut="gOut(event)">
							<s:Rect width="100%"  height="100%"
									radiusX="{10/(320/Capabilities.screenDPI)}"
									radiusY="{10/(320/Capabilities.screenDPI)}">
								<s:fill>
									<s:SolidColor alpha="1" color="#6594db"/>
								</s:fill>
							</s:Rect>
							<s:Label verticalAlign="middle" textAlign="center"  mouseEnabled="false"  
									 text="Share" color="#FFFFFF" styleName="textsize2"  
									 fontWeight="bold" horizontalCenter="0"  verticalCenter="2" />
						</s:Group>
					</s:Group>				
				</s:Group>
				<s:Group width="100%">
					<s:Line left="{20/(320/Capabilities.screenDPI)}" right="0"  bottom="0" > 
						<s:stroke><s:SolidColorStroke color="0xb2b2b2" weight="{1/(320/Capabilities.screenDPI)}"/></s:stroke>
					</s:Line>
				</s:Group>
			
				<s:Group width="100%" >
					<s:Label  left="{20/(320/Capabilities.screenDPI)}" color="#4D4D4D"
							  fontWeight="bold" styleName="textsize5"
							  id="reviewlabel" verticalAlign="middle"
							  verticalCenter="0"/>
					<s:Image id="topratedrecentimg" 
							 right="{20/(320/Capabilities.screenDPI)}" contentLoader="{s_imageCache}" 
							 click="topratedrecentclick(event)" 
							 source="{topratedrecent1}"
							 verticalCenter="0"/>
				</s:Group>
				<s:List  id="reviewList" 
						 width="100%"
						 verticalScrollPolicy="off" 
						 horizontalScrollPolicy="off" contentBackgroundAlpha="0" 
						 itemRenderer="components.ratingsResultSpecial">
					<s:layout>
						<s:VerticalLayout horizontalAlign="contentJustify" gap="0"/>
					</s:layout>
				</s:List>
				<s:Group width="100%"  click="seemoreclick();" visible="{topreviews.length > 0}" height="{70/(320/Capabilities.screenDPI)}" >
					<s:Label styleName="textsize5"  fontWeight="bold" mouseEnabled="false" color="#b3b3b3" verticalCenter="{-10/(320/Capabilities.screenDPI)}"
							 textAlign="center" horizontalCenter="0"  verticalAlign="middle" text="See More"/>
				</s:Group>
			</s:VGroup>
		</s:VGroup>
	</s:Scroller>
	<components:sharePopup id="sharePopup"  width="100%" height="100%" visible="false"/>
	<components:ratePopup height="100%" width="100%" id="reviewPopupGroup" visible="false"/>
</s:View>